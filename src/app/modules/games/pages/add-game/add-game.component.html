@let editPage = this.isEditMode();
<div class="pt-14 min-h-screen bg-gradient-subtle">
  <main class="container mx-auto px-4 lg:px-8 py-8 max-w-4xl">
    <div class="mb-8">
      <h1 class="text-4xl font-bold text-foreground mb-2 flex items-center gap-3">
        <span class="w-10 h-10 text-primary inline-flex items-center justify-center bg-primary/10 rounded-full">ğŸ†</span>
        @if (editPage) {
          Edit game
        } @else {
          Add new game
        }
      </h1>
      <p class="text-muted-foreground">
        @if (editPage) {
          Edit game and player's stats
        } @else {
          Record a new game and player's stats
        }        
      </p>
    </div>

    <form (ngSubmit)="handleSubmit()" [formGroup]="gameGroup" class="space-y-8">
      <!-- Game Details Card -->
      <div class="p-6 shadow-elevated border-border rounded-xl bg-card">
        <h2 class="text-xl font-bold text-foreground mb-6 flex items-center gap-2">
          <span class="w-5 h-5 inline-flex items-center justify-center">ğŸ†</span>
          Game details
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-2">
            <label for="date" class="flex items-center gap-2 text-sm text-foreground">
              <span class="w-4 h-4 inline-flex items-center">ğŸ“…</span>
              Date
            </label>
            <input id="date" formControlName="date" type="date" class="input border-border w-full rounded-lg bg-card text-card-foreground" />
          </div>

          <div class="space-y-2">
            <label for="location" class="flex items-center gap-2 text-sm text-foreground">
              <span class="w-4 h-4 inline-flex items-center">ğŸ“</span>
              Place
            </label>
            <input id="location" formControlName="location" type="text" placeholder="Coliseo Municipal" class="input border-border w-full rounded-lg bg-card text-card-foreground" />
          </div>

          <div class="space-y-2">
            <label for="score" class="text-sm text-foreground">Emcali' score</label>
            <input id="score" formControlName="score" type="number" min="0" placeholder="0" class="input border-border w-full rounded-lg bg-card text-card-foreground" />
          </div>

          <div class="space-y-2">
            <label for="opponent_score" class="text-sm text-foreground">Oponnent's score</label>
            <input id="opponent_score" formControlName="opponent_score" type="number" min="0" placeholder="0" class="input border-border w-full rounded-lg bg-card text-card-foreground" />
          </div>

          <div class="space-y-2 md:col-span-2">
            <label for="opponent" class="text-sm text-foreground">Oponnent's name</label>
            <input id="opponent" formControlName="opponent" type="text" placeholder="Dragones" class="input border-border w-full rounded-lg bg-card text-card-foreground" />
          </div>
        </div>
      </div>

      <!-- Player Statistics Card -->
      <div class="p-6 shadow-elevated border-border rounded-xl bg-card">
        <h2 class="text-xl font-bold text-foreground mb-6 flex items-center gap-2">
          <span class="w-5 h-5 inline-flex items-center">ğŸ‘¥</span>
          Player's stats
        </h2>

        <div class="space-y-4 mb-6">
          <div class="flex gap-3">
            <div class="flex-1">
              <!-- Select con opciones estÃ¡ticas (sin lÃ³gica) -->
              <div class="relative">
                <select
                  [formControl]="playerIdControl"
                  name="player"
                  class="w-full border-border rounded-lg p-2 bg-card text-card-foreground"
                >
                  <option value="" disabled selected>Pick a player</option>
                  @for (player of players.data(); track player.id) {
                    <option [value]="player.id">{{ player.name }} {{ player.last_name }}</option>
                  }
                </select>
              </div>
            </div>

            <button
              [disabled]="!selectedPlayer()"
              (click)="handleAddPlayer()"
              type="button"
              class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground font-semibold shadow-glow"
            >
              <span class="w-4 h-4">â•</span>
              Add
            </button>
          </div>
        </div>

        <!-- Ejemplo estÃ¡tico de lista de estadÃ­sticas para jugadores. Repetir bloques segÃºn sea necesario. -->
        <div formArrayName="players" class="space-y-4">
          @for (playerGroup of gameGroup.controls.players.controls; track $index){
            <div [formGroup]="playerGroup" class="bg-muted/50 rounded-lg p-4 border border-border">
              <div class="flex items-center justify-between mb-4">
                <span class="font-semibold text-foreground">
                  {{ playerGroup.controls.name.value }}
                </span>
                <button
                  type="button"
                  class="text-destructive hover:bg-destructive/10 rounded p-1"
                  (click)="deletePlayerGroup($index)"
                >
                  âœ–
                </button>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div class="space-y-4">
                  <label for="points-1" class="text-sm text-foreground">Points</label>
                  <input formControlName="points" id="points-1" type="number" min="0" value="12" class="input border-border w-full rounded-lg bg-card text-card-foreground" />
                </div>

                <div class="space-y-4">
                  <label for="fouls-1" class="text-sm text-foreground">Fouls</label>
                  <input formControlName="fouls" id="fouls-1" type="number" min="0" value="2" class="input border-border w-full rounded-lg bg-card text-card-foreground" />
                </div>
              </div>
            </div>
          }
        </div>

        <!-- Mensaje alternativo cuando no hay jugadores (estÃ¡tico) -->
        <!--
        <div class="text-center py-8 text-muted-foreground">
          No hay jugadores agregados. Selecciona jugadores para registrar sus estadÃ­sticas.
        </div>
        -->
      </div>

      @if (gameGroup.getError('invalidPoints')) {
        <p class="text-foreground">
          Los puntos de los jugadores con coinciden con la sumatorÃ­a de los puntos de los jugadores
        </p>
      }

      <!-- Action Buttons -->
      <div class="flex justify-end gap-4">
        <button type="button" (click)="goBack()" class="px-4 py-2 rounded-md border border-border hover:bg-destructive">Cancel</button>

        <button [disabled]="gameGroup.invalid" type="submit" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-primary/80 hover:bg-primary text-primary-foreground font-semibold">
          <span class="w-4 h-4">ğŸ†</span>
          <p>Save Game</p>
        </button>
      </div>
    </form>
  </main>
</div>
